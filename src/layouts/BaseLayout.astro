---
interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  noindex?: boolean;
}

const {
  title,
  description = 'WRLD.one - The unified directory for all WRLD platforms, services, and infrastructure. Find everything you need in one place.',
  image = '/og-image.png',
  type = 'website',
  noindex = false
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, 'https://wrld.one');
const ogImageURL = new URL(image, 'https://wrld.one');

// Structured data for organization
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "WRLD Inc",
  "alternateName": "WRLD",
  "url": "https://wrld.one",
  "logo": "https://wrld.one/favicon.svg",
  "description": "WRLD Inc provides technology solutions including hosting, domains, AI services, and cloud infrastructure.",
  "sameAs": [
    "https://github.com/WRLDInc",
    "https://twitter.com/WRLDInc"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "url": "https://wrld.support"
  }
};

// Structured data for website
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "WRLD.one",
  "alternateName": "WRLD Directory",
  "url": "https://wrld.one",
  "description": description,
  "publisher": {
    "@type": "Organization",
    "name": "WRLD Inc"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "https://wrld.one/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
};

// Breadcrumb schema (basic)
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://wrld.one"
    }
  ]
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
  <meta name="title" content={title}>
  <meta name="description" content={description}>
  <meta name="keywords" content="WRLD, wrld.one, directory, services, hosting, domains, cloud, AI, infrastructure, WRLD Inc">
  <meta name="author" content="WRLD Inc">
  <meta name="robots" content={noindex ? 'noindex, nofollow' : 'index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'}>
  <meta name="googlebot" content={noindex ? 'noindex, nofollow' : 'index, follow'}>
  <meta name="bingbot" content={noindex ? 'noindex, nofollow' : 'index, follow'}>

  <!-- Canonical URL -->
  <link rel="canonical" href={canonicalURL}>

  <!-- Theme Colors -->
  <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="color-scheme" content="dark light">
  <meta name="msapplication-TileColor" content="#0f172a">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={type}>
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={ogImageURL}>
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="WRLD.one - The WRLD Directory">
  <meta property="og:site_name" content="WRLD.one">
  <meta property="og:locale" content="en_US">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content={canonicalURL}>
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={ogImageURL}>
  <meta name="twitter:image:alt" content="WRLD.one - The WRLD Directory">
  <meta name="twitter:site" content="@WRLDInc">
  <meta name="twitter:creator" content="@WRLDInc">

  <!-- Additional SEO -->
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="WRLD.one">

  <!-- Structured Data / JSON-LD -->
  <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <!-- DNS Prefetch for performance -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">

  <!-- Preconnect for critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Fonts - WRLD Brand -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&family=Ubuntu:wght@400;500;700&family=Source+Sans+3:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.svg">

  <!-- RSS Feed (if you add one later) -->
  <!-- <link rel="alternate" type="application/rss+xml" title="WRLD.one RSS Feed" href="/rss.xml"> -->

  <title>{title}</title>
  <script>
    // Prevent FOUC - apply theme immediately
    (function() {
      try {
        const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
        document.documentElement.setAttribute('data-theme', theme);
      } catch {}
    })();
  </script>
</head>
<body>
  <!-- Background Effects -->
  <div class="bg-mesh" aria-hidden="true"></div>
  <div class="bg-grid" aria-hidden="true"></div>
  <div class="bg-noise" aria-hidden="true"></div>
  
  <!-- Floating Orbs -->
  <div class="orbs" aria-hidden="true">
    <div class="orb orb--1"></div>
    <div class="orb orb--2"></div>
    <div class="orb orb--3"></div>
  </div>

  <!-- Cursor effects -->
  <div class="cursor-ring" aria-hidden="true"></div>
  <div class="mouse-glow" aria-hidden="true"></div>
  
  <!-- Main Content -->
  <div class="app">
    <slot />
  </div>
  
  <!-- Scripts -->
  <script>
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
    
    // Add loaded class for animations
    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.add('loaded');
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        const searchInput = document.querySelector('.search-input');
        if (searchInput) searchInput.focus();
      }
    });

    // Cursor ring effect (skip if reduced motion preferred)
    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      const ring = document.querySelector('.cursor-ring');
      const glow = document.querySelector('.mouse-glow');
      let mx = 0, my = 0, rx = 0, ry = 0;

      document.addEventListener('pointermove', (e) => {
        mx = e.clientX;
        my = e.clientY;
        document.documentElement.style.setProperty('--mouse-x', mx + 'px');
        document.documentElement.style.setProperty('--mouse-y', my + 'px');
      });

      function animate() {
        rx += (mx - rx) * 0.15;
        ry += (my - ry) * 0.15;
        ring.style.transform = `translate(${rx}px, ${ry}px)`;
        requestAnimationFrame(animate);
      }
      animate();
    }
  </script>
</body>
</html>

<style is:global>
  @import '../styles/global.css';
  
  .app {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  /* Cursor effects */
  .cursor-ring {
    position: fixed;
    width: 32px;
    height: 32px;
    border: 1.5px solid var(--accent-primary);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    opacity: 0.6;
    box-shadow: 0 0 20px rgba(0, 173, 238, 0.3);
    transform: translate(-50%, -50%);
  }

  .mouse-glow {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    background: radial-gradient(circle 300px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(0, 173, 238, 0.08), transparent 70%);
    mix-blend-mode: screen;
  }

  @media (prefers-reduced-motion: reduce) {
    .cursor-ring, .mouse-glow { display: none; }
  }

  /* Floating Orbs */
  .orbs {
    position: fixed;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }
  
  .orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(100px);
    opacity: 0.15;
    animation: orbFloat 25s ease-in-out infinite;
  }
  
  /* Hide orbs in light mode for clean look */
  [data-theme="light"] .orb {
    display: none;
  }

  @media (prefers-color-scheme: light) {
    :root:not([data-theme]) .orb {
      display: none;
    }
  }

  /* Hide/reduce background effects in light mode */
  [data-theme="light"] .bg-mesh,
  [data-theme="light"] .bg-grid,
  [data-theme="light"] .bg-noise {
    opacity: 0;
  }

  [data-theme="light"] .cursor-ring {
    opacity: 0.3;
  }

  [data-theme="light"] .mouse-glow {
    background: radial-gradient(circle 300px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(59, 130, 246, 0.03), transparent 70%);
  }

  @media (prefers-color-scheme: light) {
    :root:not([data-theme]) .bg-mesh,
    :root:not([data-theme]) .bg-grid,
    :root:not([data-theme]) .bg-noise {
      opacity: 0;
    }

    :root:not([data-theme]) .cursor-ring {
      opacity: 0.3;
    }

    :root:not([data-theme]) .mouse-glow {
      background: radial-gradient(circle 300px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(59, 130, 246, 0.03), transparent 70%);
    }
  }
  
  .orb--1 {
    width: 500px;
    height: 500px;
    background: var(--accent-primary);
    top: -150px;
    left: -150px;
    animation-delay: 0s;
    opacity: 0.12;
  }
  
  .orb--2 {
    width: 400px;
    height: 400px;
    background: var(--accent-purple);
    bottom: -100px;
    right: -100px;
    animation-delay: -7s;
    opacity: 0.1;
  }
  
  .orb--3 {
    width: 300px;
    height: 300px;
    background: var(--accent-gold);
    top: 40%;
    right: 15%;
    animation-delay: -14s;
    opacity: 0.08;
  }
  
  @keyframes orbFloat {
    0%, 100% {
      transform: translate(0, 0) scale(1);
    }
    25% {
      transform: translate(30px, -30px) scale(1.05);
    }
    50% {
      transform: translate(-20px, 20px) scale(0.95);
    }
    75% {
      transform: translate(20px, 30px) scale(1.02);
    }
  }
  
  /* Loading state */
  body:not(.loaded) .animate-slide-up,
  body:not(.loaded) .stagger-children > * {
    opacity: 0;
  }
</style>
